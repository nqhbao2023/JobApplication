// ========================================
// Database Schema - Job4S Application
// Firestore NoSQL - 12 Collections
// ========================================

Table users {
  uid string [pk, note: "Firebase Auth UID"]
  email string
  name string
  phone string
  role string [note: "candidate | employer | admin"]
  photoURL string
  studentProfile map [note: "Thông tin sinh viên"]
  createdAt timestamp
  updatedAt timestamp
}

Table jobs {
  id string [pk]
  title string
  description string
  location string
  
  // Phân loại job
  source string [note: "internal | viecoi | quick-post"]
  jobType string [note: "employer_seeking | candidate_seeking"]
  status string [note: "active | inactive | pending | closed"]
  
  // Liên kết
  companyId string [ref: > companies.id]
  employerId string [ref: > users.uid]
  posterId string [ref: > users.uid]
  category string
  
  // Lương
  salary_text string
  salary_min number
  salary_max number
  
  // Thông tin thêm
  requirements array
  benefits array
  contactInfo map [note: "{phone, email, zalo}"]
  
  // Thống kê
  viewCount number
  applicantCount number
  isVerified boolean
  
  createdAt timestamp
  updatedAt timestamp
}

Table applications {
  id string [pk]
  jobId string [ref: > jobs.id]
  candidateId string [ref: > users.uid]
  employerId string [ref: > users.uid]
  cvUrl string
  coverLetter string
  status string [note: "pending | accepted | rejected"]
  appliedAt timestamp
  updatedAt timestamp
}

Table applied_jobs {
  id string [pk]
  userId string [ref: > users.uid]
  jobId string [ref: > jobs.id]
  employerId string
  jobInfo map [note: "{title, company, salary}"]
  userInfo map [note: "{name, email, photoURL}"]
  cv_url string
  cv_path string
  cv_uploaded boolean
  status string
  applied_at timestamp
  updated_at timestamp
}

Table companies {
  id string [pk]
  corp_name string
  corp_description string
  city string
  nation string
  image string
  color string
  ownerId string [ref: > users.uid]
  created_at timestamp
  updated_at timestamp
}

Table job_categories {
  id string [pk]
  category_name string
  icon_name string
  color string
  description string
  created_at string
}

Table job_types {
  id string [pk]
  type_name string
  slug string
  icon string
  color string
  description string
  isSystem boolean
  created_at timestamp
  updated_at timestamp
}

Table cvs {
  id string [pk]
  userId string [ref: > users.uid]
  type string [note: "template | uploaded"]
  pdfUrl string
  personalInfo map [note: "{fullName, email, phone, address, avatar}"]
  objective string
  education array
  skills array
  experience array
  projects array
  activities array
  certifications array
  languages array
  isDefault boolean
  templateId string
  createdAt string
  updatedAt string
}

Table saved_jobs {
  id string [pk]
  userId string [ref: > users.uid]
  jobId string [ref: > jobs.id]
  savedAt timestamp
  created_at string
}

Table chats {
  id string [pk, note: "uid1_uid2"]
  participants array [note: "Array of 2 user IDs"]
  participantsInfo map [note: "{userId: {displayName, photoURL, role}}"]
  lastMessage string
  messages map [note: "{lastMessage}"]
  updatedAt timestamp
}

// Subcollection: chats/{id}/messages
Table chat_messages {
  id string [pk]
  chatId string [ref: > chats.id]
  senderId string [ref: > users.uid]
  text string
  senderRole string [note: "Recruiter | Candidate"]
  createdAt timestamp
}

Table notifications {
  id string [pk]
  userId string [ref: > users.uid]
  title string
  message string
  type string [note: "application | job | system"]
  read boolean
  status string
  jobId string [ref: > jobs.id]
  applicationId string
  created_at timestamp
}

// ========================================
// RELATIONSHIPS
// ========================================

// Jobs -> Categories
Ref: jobs.category > job_categories.id
