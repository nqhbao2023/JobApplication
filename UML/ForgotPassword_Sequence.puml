@startuml ForgotPassword_Sequence
title Sơ đồ tuần tự: Quên mật khẩu
hide footbox

actor "Người dùng" as User
participant "Giao diện Quên MK\n(View)" as View
participant "Hệ thống OTP\n(OTP Service)" as OTP
participant "Hệ thống xử lý\n(Controller/API)" as System
database "Cơ sở dữ liệu\n(Database)" as DB

User -> View: 1. Nhập Email đã đăng ký
User -> View: 2. Nhấn "Gửi mã xác nhận"
activate View

View -> System: 3. Kiểm tra Email tồn tại
activate System
System -> DB: 4. Truy vấn thông tin User
activate DB
DB --> System: 5. User tồn tại
deactivate DB

System -> OTP: 6. Tạo & Gửi OTP qua Email
activate OTP
OTP --> System: 7. Gửi thành công
deactivate OTP
System --> View: 8. Yêu cầu nhập OTP
deactivate System

User -> View: 9. Nhập mã OTP & Mật khẩu mới
View -> System: 10. Gửi yêu cầu đặt lại mật khẩu
activate System

System -> OTP: 11. Xác thực mã OTP
activate OTP
OTP --> System: 12. Mã hợp lệ
deactivate OTP

System -> DB: 13. Cập nhật mật khẩu mới
activate DB
DB --> System: 14. Cập nhật thành công
deactivate DB

System --> View: 15. Thông báo thành công
deactivate System

View -> User: 16. Chuyển về trang Đăng nhập
deactivate View

@enduml
